<VirtualHost *:80>
  ServerName <%= node['sonar']['web_domain'] %>
  ServerAdmin admin@<%= node['sonar']['web_domain'] %>
  
  ProxyRequests Off
  ProxyPreserveHost On
  ProxyPass / http://<%= node['sonar']['web_host'] %>:<%= node['sonar']['web_port'] %>/
  ProxyPassReverse / http://<%= node['sonar']['web_host'] %>:<%= node['sonar']['web_port'] %>/
  
  ErrorLog /var/log/apache2/<%= node['sonar']['web_domain'] %>.error.log
  CustomLog /var/log/apache2/<%= node['sonar']['web_domain'] %>.access.log common
  
  <Proxy http://<%= node['sonar']['web_host'] %>:<%= node['sonar']['web_port'] %>/* >
    Order deny,allow
    Allow from all
  </Proxy>
</VirtualHost>